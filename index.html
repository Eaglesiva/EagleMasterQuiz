<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EAGLE Quiz Maker Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- SEO -->
  <meta name="description" content="EAGLE Quiz Maker Pro ‚Äì build, style and export powerful quiz apps from Google Sheets or manual input.">
  <meta name="keywords" content="EAGLE Quiz Maker Pro, Quiz Builder, MCQ Maker, Leo Quiz, Eaglesiva">
  <meta name="author" content="ü¶Ö Eaglesiva">

  <!-- Favicon (you can change this URL) -->
  <link rel="icon" href="https://raw.githubusercontent.com/Eaglesiva/EagleMasterQuiz/main/favicon.png">

  <style>
:root {
  --primary: #22c55e;
  --primary-dark: #16a34a;
  --bg: #0f172a;
  --card: #1e293b;
  --text: #f1f5f9;
  --muted: #94a3b8;
  --radius: 14px;
}

/* Light mode base */
body.light {
  --bg: #e5e7eb;
  --card: #ffffff;
  --text: #0f172a;
  --muted: #64748b;
}

/* Reset */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
}

body {
  font-family: "Inter", system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  justify-content: center;
}

.app-shell {
  width: 100%;
  max-width: 1350px;
  margin: auto;
  padding: 12px;
}

/* HEADER */
.app-header {
  background: var(--card);
  border-radius: var(--radius);
  padding: 14px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

.logo-circle {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: conic-gradient(from 180deg, var(--primary), #0ea5e9, #f97316, var(--primary));
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 26px;
  animation: rotate 6s linear infinite;
}

@keyframes rotate {
  to { transform: rotate(360deg); }
}

.app-title-wrap {
  display: flex;
  align-items: center;
  gap: 12px;
}

.title-texts .app-title {
  font-size: 20px;
  font-weight: 800;
}

.app-subtitle {
  font-size: 12px;
  color: var(--muted);
  margin-top: 2px;
}

.app-badge {
  font-size: 11px;
  padding: 4px 9px;
  border-radius: 999px;
  background: rgba(34,197,94,0.15);
  border: 1px solid var(--primary);
  white-space: nowrap;
}

.header-actions {
  display: flex;
  gap: 8px;
}

/* BUTTON STYLES */
button {
  cursor: pointer;
  transition: .25s;
}

.primary-btn, .secondary-btn, .ghost-btn {
  border-radius: var(--radius);
  padding: 8px 14px;
  font-weight: 600;
  font-size: 14px;
  white-space: nowrap;
}

.primary-btn {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: #022c22;
}

.secondary-btn {
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.12);
}

.ghost-btn {
  background: transparent;
  border: 1px dashed rgba(255,255,255,0.4);
  color: var(--text);
}

button.small {
  font-size: 12px;
  padding: 6px 10px;
}

/* MAIN BODY SPLIT */
.app-main {
  display: flex;
  margin-top: 14px;
  gap: 10px;
}

.tab-sidebar {
  width: 210px;
  background: var(--card);
  border-radius: var(--radius);
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.tab-button {
  padding: 12px;
  border-radius: var(--radius);
  background: transparent;
  color: var(--text);
  text-align: left;
  border: 1px solid rgba(255,255,255,0.14);
}

.tab-button.active {
  background: rgba(34,197,94,0.17);
  border-color: var(--primary);
}

.tab-panels {
  flex: 1;
}

.tab-panel {
  display: none;
  background: var(--card);
  border-radius: var(--radius);
  padding: 16px;
}

.tab-panel.active {
  display: block;
}

/* PANEL ELEMENTS */
h2 {
  font-size: 20px;
  margin-bottom: 8px;
}

.panel-help {
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 16px;
}

.panel-grid {
  display: grid;
  gap: 14px;
  grid-template-columns: 1fr 1fr;
}

.panel-block {
  background: rgba(255,255,255,0.04);
  border-radius: var(--radius);
  padding: 14px;
  border: 1px solid rgba(255,255,255,0.06);
}

.field {
  margin-bottom: 14px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

textarea,
input[type="text"],
input[type="url"],
input[type="number"],
select {
  padding: 10px;
  border-radius: var(--radius);
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.06);
  color: var(--text);
  font-size: 14px;
}

textarea { resize: vertical; }

.field.inline {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}

/* QUIZ LIST */
.quiz-list {
  max-height: 420px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.quiz-item {
  padding: 10px;
  border-radius: var(--radius);
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.12);
  cursor: pointer;
}

.status-bar {
  font-size: 13px;
  margin-top: 6px;
  color: var(--muted);
}

/* THEME GRID */
.theme-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
}

.theme-chip {
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(255,255,255,0.05);
  padding: 6px;
  border-radius: var(--radius);
  border: 1px solid rgba(255,255,255,0.12);
}

.theme-color {
  width: 20px;
  height: 20px;
  border-radius: 50%;
}

/* preset preview colors */
.theme-green { background: #1cb34c; }
.theme-blue { background: #1b6dff; }
.theme-purple { background: #b316ff; }
.theme-neon { background: #00f5ff; }
.theme-orange { background: #ff7a18; }
.theme-pink { background: #ff2bbd; }
.theme-mint { background: #1affb2; }
.theme-steel { background: #4f5b66; }

/* RESULT BUTTON SETUP */
.result-button-row {
  margin-bottom: 12px;
  display: grid;
  gap: 6px;
}

/* SIMPLE PREVIEW CARD */
.preview-card {
  margin-top: 10px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: var(--radius);
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.preview-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.preview-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.preview-btn {
  background: var(--primary);
  border: none;
  color: #022c22;
  padding: 6px 10px;
  border-radius: var(--radius);
}

/* MOBILE */
@media (max-width: 930px) {
  .app-main {
    flex-direction: column;
  }
  .tab-sidebar {
    width: 100%;
    flex-direction: row;
    overflow-x: auto;
  }
  .panel-grid {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>
  <div class="app-shell">
    <!-- HEADER -->
    <header class="app-header">
      <div class="app-title-wrap">
        <div class="logo-circle">ü¶Ö</div>
        <div class="title-texts">
          <h1 class="app-title">EAGLE Quiz Maker Pro</h1>
          <p class="app-subtitle">Build once, export unlimited Leo Quiz players</p>
        </div>
        <span class="app-badge">ü¶Ö PRO</span>
      </div>

      <div class="header-actions">
        <button id="themeToggle" class="ghost-btn">‚òÄ / üåô</button>
        <button id="previewBtnHeader" class="secondary-btn small">üëÅ Preview</button>
        <button id="exportBtnHeader" class="primary-btn small">üì§ Export Player</button>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="app-main">
      <!-- SIDEBAR TABS -->
      <aside class="tab-sidebar">
        <button class="tab-button active" data-tab-target="#tab-quiz">
          üìù Quiz Data
        </button>
        <button class="tab-button" data-tab-target="#tab-design">
          üé® Design & Theme
        </button>
        <button class="tab-button" data-tab-target="#tab-export">
          ‚öôÔ∏è Export Settings
        </button>
      </aside>

      <!-- TAB PANELS -->
      <section class="tab-panels">

        <!-- TAB 1 ‚Äì QUIZ DATA -->
        <section id="tab-quiz" class="tab-panel active">
          <h2>üìù Quiz Data</h2>
          <p class="panel-help">
            Enter quiz title, description and questions. You can type manually or paste from your sheet export.
          </p>

          <div class="panel-grid">
            <div class="panel-block">
              <label class="field">
                <span>Quiz Title</span>
                <input id="quizTitle" type="text" placeholder="e.g. Class 10 Science Test" />
              </label>

              <label class="field">
                <span>Quiz Description</span>
                <textarea id="quizDescription" rows="2" placeholder="Short description for this quiz..."></textarea>
              </label>

              <label class="field">
                <span>Questions (one per line)</span>
                <p class="help-text">
                  Format:
                  <code>Question ? || Option A || Option B || Option C || Option D || correctOptionNumber</code><br />
                  Example:<br />
                  <code>What is 2+2? || 3 || 4 || 5 || 6 || 2</code>
                </p>
                <textarea id="quizQuestions" rows="10"
                  placeholder="Capital of India? || Delhi || Mumbai || Chennai || Kolkata || 1&#10;..."></textarea>
              </label>

              <div class="button-row">
                <button id="btnNewQuiz" class="ghost-btn small">üßπ New</button>
                <button id="btnSaveQuiz" class="primary-btn">üíæ Save Quiz</button>
                <button id="btnPreviewQuiz" class="secondary-btn">üëÅ Preview Player</button>
              </div>

              <p id="statusBar" class="status-bar">Ready.</p>
            </div>

            <div class="panel-block">
              <h3>üìö Saved Quizzes</h3>
              <p class="panel-help small">Click a quiz to load & edit. Data is saved in your browser.</p>
              <div id="quizList" class="quiz-list">
                <!-- filled by JS -->
              </div>

              <div class="divider"></div>

              <h3>üìÇ Import / Export Data</h3>
              <div class="button-row">
                <button id="btnExportJson" class="secondary-btn small">üì§ Export JSON</button>
                <button id="btnImportJson" class="ghost-btn small">üì• Import JSON</button>
              </div>
              <input type="file" id="importFile" accept="application/json" hidden />
            </div>
          </div>
        </section>

        <!-- TAB 2 ‚Äì DESIGN & THEME -->
        <section id="tab-design" class="tab-panel">
          <h2>üé® Design & Theme</h2>
          <p class="panel-help">
            Choose light/dark mode, color presets and background for your exported Leo Quiz player.
          </p>

          <div class="panel-grid">
            <div class="panel-block">
              <h3>Theme Mode</h3>
              <div class="field inline">
                <label>
                  <input type="radio" name="themeMode" value="dark" checked />
                  Dark (default)
                </label>
                <label>
                  <input type="radio" name="themeMode" value="light" />
                  Light
                </label>
              </div>

              <h3>Theme Presets</h3>
              <p class="panel-help small">Pick a style. Colors will be applied inside the player automatically.</p>

              <div class="theme-grid">
                <label class="theme-chip">
                  <input type="radio" name="themePreset" value="green-pro" checked />
                  <span class="theme-color theme-green"></span>
                  <span>Green Pro</span>
                </label>
                <label class="theme-chip">
                  <input type="radio" name="themePreset" value="blue-modern" />
                  <span class="theme-color theme-blue"></span>
                  <span>Blue Modern</span>
                </label>
                <label class="theme-chip">
                  <input type="radio" name="themePreset" value="purple-glow" />
                  <span class="theme-color theme-purple"></span>
                  <span>Purple Glow</span>
                </label>
                <label class="theme-chip">
                  <input type="radio" name="themePreset" value="neon-gamer" />
                  <span class="theme-color theme-neon"></span>
                  <span>Neon Gamer</span>
                </label>
                <label class="theme-chip">
                  <input type="radio" name="themePreset" value="orange-fire" />
                  <span class="theme-color theme-orange"></span>
                  <span>Orange Fire</span>
                </label>
                <label class="theme-chip">
                  <input type="radio" name="themePreset" value="pink-kids" />
                  <span class="theme-color theme-pink"></span>
                  <span>Pink Kids</span>
                </label>
                <label class="theme-chip">
                  <input type="radio" name="themePreset" value="cartoon-mint" />
                  <span class="theme-color theme-mint"></span>
                  <span>Cartoon Mint</span>
                </label>
                <label class="theme-chip">
                  <input type="radio" name="themePreset" value="steel-dark" />
                  <span class="theme-color theme-steel"></span>
                  <span>Steel Dark</span>
                </label>
              </div>

              <h3>Background</h3>
              <p class="panel-help small">Use built-in gradient or your own image (for YouTube recording style).</p>
              <div class="field">
                <label>
                  <input type="radio" name="bgMode" value="gradient" checked />
                  Use default gradient background
                </label>
                <label>
                  <input type="radio" name="bgMode" value="image" />
                  Use custom background image URL
                </label>
              </div>
              <label class="field">
                <span>Background Image URL (optional)</span>
                <input id="bgImageUrl" type="url" placeholder="https://example.com/image.jpg" />
              </label>

              <label class="field">
                <span>App Icon URL (for circle logo ‚Äì optional)</span>
                <input id="appIconUrl" type="url" placeholder="https://example.com/icon.png" />
              </label>
            </div>

            <div class="panel-block">
              <h3>Live Preview (simple style)</h3>
              <p class="panel-help small">Just a rough preview of colors. Real player will look like Leo V6.2 UI.</p>

              <div class="preview-card" id="designPreview">
                <div class="preview-header">
                  <div class="preview-logo">üêæ</div>
                  <div class="preview-titles">
                    <div class="preview-title">Leo Quiz</div>
                    <div class="preview-sub">Sample question style</div>
                  </div>
                  <span class="preview-badge">ü¶Ö PRO</span>
                </div>
                <div class="preview-question">
                  Example question: What is 2 + 2?
                </div>
                <div class="preview-options">
                  <div class="preview-option">A) 3</div>
                  <div class="preview-option">B) 4</div>
                  <div class="preview-option">C) 5</div>
                  <div class="preview-option">D) 22</div>
                </div>
                <div class="preview-footer">
                  <span>Timer ‚Ä¢ Voice ‚Ä¢ Sound</span>
                  <button class="preview-btn">Next ‚Üí</button>
                </div>
              </div>

              <div class="button-row right">
                <button id="previewBtnDesign" class="secondary-btn small">üëÅ Preview Player</button>
              </div>
            </div>
          </div>
        </section>

        <!-- TAB 3 ‚Äì EXPORT SETTINGS -->
        <section id="tab-export" class="tab-panel">
          <h2>‚öôÔ∏è Export Settings</h2>
          <p class="panel-help">
            Configure how the standalone quiz player behaves. These options will be baked into the exported HTML.
          </p>

          <div class="panel-grid">
            <div class="panel-block">
              <h3>Player Identity</h3>

              <label class="field">
                <span>Player Title</span>
                <input id="playerTitle" type="text" value="Leo Quiz"
                       placeholder="Shown in header & browser tab" />
              </label>

              <label class="field">
                <span>Badge Text (right side of title)</span>
                <input id="badgeText" type="text" value="ü¶Ö PRO"
                       placeholder="e.g. ü¶Ö PRO, GK, 100Q, Tamil Test" />
              </label>

              <label class="field">
                <span>About Text</span>
                <textarea id="aboutText" rows="2">Created by ü¶Ö Eaglesiva</textarea>
              </label>

              <label class="field">
                <span>Footer Text (Result screen bottom)</span>
                <textarea id="footerText" rows="2">Powered by ü¶Ö Eaglesiva</textarea>
              </label>

              <h3>Player Behaviour</h3>

              <label class="field">
                <span>Default Timer Mode</span>
                <select id="timerDefault">
                  <option value="off">‚è± Off (no timer)</option>
                  <option value="10">‚è± 10 seconds</option>
                  <option value="20">‚è± 20 seconds</option>
                  <option value="30">‚è± 30 seconds</option>
                  <option value="nolimit">‚è± ‚àû No limit</option>
                </select>
              </label>

              <div class="field inline">
                <label>
                  <input type="checkbox" id="voiceDefault" checked />
                  Voice ON by default
                </label>
                <label>
                  <input type="checkbox" id="soundDefault" checked />
                  Sound ON by default
                </label>
                <label>
                  <input type="checkbox" id="fullscreenDefault" />
                  Fullscreen ON (try full on start)
                </label>
              </div>

              <label class="field">
                <span>Auto-next delay after answer (ms)</span>
                <input id="autoNextDelay" type="number" min="400" max="5000" step="100" value="1200" />
                <p class="help-text small">Recommended: 1200 ms (1.2 seconds)</p>
              </label>
            </div>

            <div class="panel-block">
              <h3>Result Screen Buttons (up to 6)</h3>
              <p class="panel-help small">
                Each enabled button will appear on the result screen. If toggle is OFF, that button is hidden.
              </p>

              <div class="result-buttons-config">
                <!-- Button 1 -->
                <div class="result-button-row">
                  <label class="field inline">
                    <input type="checkbox" class="result-toggle" data-index="0" />
                    <span>Button 1 enabled</span>
                  </label>
                  <input type="text" class="result-label" data-index="0" placeholder="Button 1 text (e.g. Watch video)" />
                  <input type="url" class="result-url" data-index="0" placeholder="https://..." />
                </div>

                <!-- Button 2 -->
                <div class="result-button-row">
                  <label class="field inline">
                    <input type="checkbox" class="result-toggle" data-index="1" />
                    <span>Button 2 enabled</span>
                  </label>
                  <input type="text" class="result-label" data-index="1" placeholder="Button 2 text" />
                  <input type="url" class="result-url" data-index="1" placeholder="https://..." />
                </div>

                <!-- Button 3 -->
                <div class="result-button-row">
                  <label class="field inline">
                    <input type="checkbox" class="result-toggle" data-index="2" />
                    <span>Button 3 enabled</span>
                  </label>
                  <input type="text" class="result-label" data-index="2" placeholder="Button 3 text" />
                  <input type="url" class="result-url" data-index="2" placeholder="https://..." />
                </div>

                <!-- Button 4 -->
                <div class="result-button-row">
                  <label class="field inline">
                    <input type="checkbox" class="result-toggle" data-index="3" />
                    <span>Button 4 enabled</span>
                  </label>
                  <input type="text" class="result-label" data-index="3" placeholder="Button 4 text" />
                  <input type="url" class="result-url" data-index="3" placeholder="https://..." />
                </div>

                <!-- Button 5 -->
                <div class="result-button-row">
                  <label class="field inline">
                    <input type="checkbox" class="result-toggle" data-index="4" />
                    <span>Button 5 enabled</span>
                  </label>
                  <input type="text" class="result-label" data-index="4" placeholder="Button 5 text" />
                  <input type="url" class="result-url" data-index="4" placeholder="https://..." />
                </div>

                <!-- Button 6 -->
                <div class="result-button-row">
                  <label class="field inline">
                    <input type="checkbox" class="result-toggle" data-index="5" />
                    <span>Button 6 enabled</span>
                  </label>
                  <input type="text" class="result-label" data-index="5" placeholder="Button 6 text" />
                  <input type="url" class="result-url" data-index="5" placeholder="https://..." />
                </div>
              </div>

              <div class="divider"></div>

              <h3>Preview & Export</h3>
              <p class="panel-help small">
                Preview will open a temporary Leo Quiz V6.2 player in a new tab. Export will download the final HTML.
              </p>

              <div class="button-row">
                <button id="previewBtnExport" class="secondary-btn">üëÅ Preview Player</button>
                <button id="exportBtnMain" class="primary-btn">üì§ Export Leo Quiz Player</button>
              </div>
            </div>
          </div>
        </section>

      </section>
    </main>
  </div>

  <!-- PART-C: JavaScript (logic) will come here -->
  <script>
    // Placeholder: real JS logic will be added in PART-C
    // For now, we just wire basic tab switching so UI is not dead.

    (function () {
      const tabButtons = document.querySelectorAll(".tab-button");
      const tabPanels = document.querySelectorAll(".tab-panel");

      tabButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const target = btn.getAttribute("data-tab-target");
          if (!target) return;

          tabButtons.forEach(b => b.classList.remove("active"));
          tabPanels.forEach(p => p.classList.remove("active"));

          btn.classList.add("active");
          const panel = document.querySelector(target);
          if (panel) panel.classList.add("active");
        });
      });
    })();
  </script>
  <script>
/* =========================
   EAGLE Quiz Maker Pro ‚Äì Engine
   Created by ü¶Ö Eaglesiva
   ========================= */

const LS_KEY = "eagle_quiz_maker_pro_v63";

/* Load saved state from localStorage */
let state = JSON.parse(localStorage.getItem(LS_KEY) || "{}");

/* Save state helper */
function saveState() {
  localStorage.setItem(LS_KEY, JSON.stringify(state));
}

/* ====== DOM refs ====== */
const quizTitle = document.getElementById("quizTitle");
const quizDescription = document.getElementById("quizDescription");
const quizQuestions = document.getElementById("quizQuestions");
const quizList = document.getElementById("quizList");
const statusBar = document.getElementById("statusBar");

const playerTitle = document.getElementById("playerTitle");
const badgeText = document.getElementById("badgeText");
const aboutText = document.getElementById("aboutText");
const footerText = document.getElementById("footerText");

const timerDefault = document.getElementById("timerDefault");
const voiceDefault = document.getElementById("voiceDefault");
const soundDefault = document.getElementById("soundDefault");
const fullscreenDefault = document.getElementById("fullscreenDefault");
const autoNextDelay = document.getElementById("autoNextDelay");

const bgImageUrl = document.getElementById("bgImageUrl");
const appIconUrl = document.getElementById("appIconUrl");

/* Result buttons */
const resultToggles = document.querySelectorAll(".result-toggle");
const resultLabels = document.querySelectorAll(".result-label");
const resultUrls = document.querySelectorAll(".result-url");

/* Theme */
const themeModeInputs = document.querySelectorAll("input[name='themeMode']");
const themePresetInputs = document.querySelectorAll("input[name='themePreset']");

/* Storage inside the app */
state.savedQuizzes = state.savedQuizzes || [];

/* Fill quiz list on load */
function refreshQuizList() {
  quizList.innerHTML = "";
  state.savedQuizzes.forEach((q, index) => {
    const div = document.createElement("div");
    div.className = "quiz-item";
    div.textContent = q.title || "Untitled Quiz";
    div.addEventListener("click", () => loadQuiz(index));
    quizList.appendChild(div);
  });
}

/* Load quiz into editor */
function loadQuiz(index) {
  const q = state.savedQuizzes[index];
  quizTitle.value = q.title;
  quizDescription.value = q.description;
  quizQuestions.value = q.questions;
  statusBar.textContent = `Loaded quiz: ${q.title}`;
}

/* Save quiz to localStorage */
document.getElementById("btnSaveQuiz").onclick = () => {
  if (!quizTitle.value.trim()) {
    alert("Enter quiz title!");
    return;
  }
  const entry = {
    title: quizTitle.value.trim(),
    description: quizDescription.value.trim(),
    questions: quizQuestions.value.trim()
  };
  state.savedQuizzes.push(entry);
  saveState();
  refreshQuizList();
  statusBar.textContent = "Quiz saved!";
};

/* New empty quiz */
document.getElementById("btnNewQuiz").onclick = () => {
  quizTitle.value = "";
  quizDescription.value = "";
  quizQuestions.value = "";
  statusBar.textContent = "Ready for new quiz.";
};

/* JSON export */
document.getElementById("btnExportJson").onclick = () => {
  const blob = new Blob([JSON.stringify(state.savedQuizzes, null, 2)], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "quizzes.json";
  a.click();
};

/* JSON import */
document.getElementById("btnImportJson").onclick = () => {
  document.getElementById("importFile").click();
};
document.getElementById("importFile").onchange = (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    state.savedQuizzes = JSON.parse(reader.result);
    saveState();
    refreshQuizList();
    alert("Import Successful!");
  };
  reader.readAsText(file);
};

/* Save form data continuously */
setInterval(() => {
  state.lastForm = {
    quizTitle: quizTitle.value,
    quizDescription: quizDescription.value,
    quizQuestions: quizQuestions.value,
    playerTitle: playerTitle.value,
    badgeText: badgeText.value,
    aboutText: aboutText.value,
    footerText: footerText.value,
    timer: timerDefault.value,
    voice: voiceDefault.checked,
    sound: soundDefault.checked,
    fullscreen: fullscreenDefault.checked,
    autoNextDelay: autoNextDelay.value,
    bgImageUrl: bgImageUrl.value,
    appIconUrl: appIconUrl.value,
    resultBtns: Array.from(resultToggles).map((t, i) => ({
      enabled: t.checked,
      label: resultLabels[i].value,
      url: resultUrls[i].value
    })),
    themeMode: [...themeModeInputs].find(x => x.checked)?.value,
    themePreset: [...themePresetInputs].find(x => x.checked)?.value
  };
  saveState();
}, 600);

/* Restore last form */
if (state.lastForm) {
  quizTitle.value = state.lastForm.quizTitle || "";
  quizDescription.value = state.lastForm.quizDescription || "";
  quizQuestions.value = state.lastForm.quizQuestions || "";

  playerTitle.value = state.lastForm.playerTitle || "Leo Quiz";
  badgeText.value = state.lastForm.badgeText || "ü¶Ö PRO";
  aboutText.value = state.lastForm.aboutText || "Created by ü¶Ö Eaglesiva";
  footerText.value = state.lastForm.footerText || "Powered by ü¶Ö Eaglesiva";

  timerDefault.value = state.lastForm.timer || "off";
  voiceDefault.checked = state.lastForm.voice ?? true;
  soundDefault.checked = state.lastForm.sound ?? true;
  fullscreenDefault.checked = state.lastForm.fullscreen ?? false;
  autoNextDelay.value = state.lastForm.autoNextDelay || "1200";

  bgImageUrl.value = state.lastForm.bgImageUrl || "";
  appIconUrl.value = state.lastForm.appIconUrl || "";

  [...themeModeInputs].forEach(x => x.checked = (x.value === state.lastForm.themeMode));
  [...themePresetInputs].forEach(x => x.checked = (x.value === state.lastForm.themePreset));

  if (Array.isArray(state.lastForm.resultBtns)) {
    state.lastForm.resultBtns.forEach((btn, i) => {
      resultToggles[i].checked = btn.enabled;
      resultLabels[i].value = btn.label;
      resultUrls[i].value = btn.url;
    });
  }
}

/* Refresh list on load */
refreshQuizList();

/* ====== PREVIEW & EXPORT ====== */
function buildPlayerHtml() {
  const rows = quizQuestions.value.trim().split("\n").filter(Boolean);
  const questions = [];
  for (let r of rows) {
    const p = r.split("||").map(x => x.trim());
    if (p.length === 6) {
      questions.push({
        q: p[0],
        options: [p[1], p[2], p[3], p[4]],
        correctIndex: Number(p[5]) - 1
      });
    }
  }

  const btns = state.lastForm.resultBtns.filter(b => b.enabled && b.label && b.url);

  /* Insert into V6.2 engine */
  return `
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>${playerTitle.value}</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<style>
/* V6.2 PLAYER CSS WILL AUTO-INJECT HERE (condensed version) */
</style>
</head>
<body>
<script>
const PLAYER_DATA = {
  title: "${playerTitle.value}",
  badge: "${badgeText.value}",
  about: \`${aboutText.value}\`,
  footer: \`${footerText.value}\`,
  themePreset: "${state.lastForm.themePreset}",
  themeMode: "${state.lastForm.themeMode}",
  timer: "${timerDefault.value}",
  voice: ${voiceDefault.checked},
  sound: ${soundDefault.checked},
  fullscreen: ${fullscreenDefault.checked},
  autoNext: ${autoNextDelay.value},
  bgImage: "${bgImageUrl.value}",
  iconUrl: "${appIconUrl.value}",
  resultButtons: ${JSON.stringify(btns)},
  questions: ${JSON.stringify(questions)}
};
</script>
</body>
</html>


